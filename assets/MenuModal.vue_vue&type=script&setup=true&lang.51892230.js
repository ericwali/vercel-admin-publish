var e=(e,o,a)=>new Promise(((t,l)=>{var n=e=>{try{r(a.next(e))}catch(o){l(o)}},i=e=>{try{r(a.throw(e))}catch(o){l(o)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);r((a=a.apply(e,o)).next())}));import{d as o,c as a}from"./useForm.f93bccee.js";import{af as t,c1 as l,B as n,N as i,D as r,_ as s,a2 as d,w as p,u as c,a1 as u,t as m}from"./vendor.7c679a32.js";/* empty css              */import{_ as f,aG as h,aH as v}from"./index.6a5548ea.js";import{g as b,l as P,e as y,a as g}from"./menu.9d58d752.js";import{a as I,B as w}from"./index.1d3e54eb.js";const R=e=>"C"===e,x=e=>"F"===e,M=[{title:"菜单名称",dataIndex:"name",align:"left"},{title:"图标",dataIndex:"icon",width:100,customRender:({record:e})=>e.icon?t(f,{icon:e.icon}):t(l,{color:"red"},(()=>"暂无图标"))},{title:"排序",dataIndex:"sort",width:80},{title:"权限标识",dataIndex:"permission",customRender:({record:e})=>e.permission||t(l,{color:"red"},(()=>"暂无数据"))},{title:"组件",dataIndex:"component",customRender:({record:e})=>e.component||t(l,{color:"red"},(()=>"暂无数据"))},{title:"是否隐藏",dataIndex:"hideMenu",width:80,customRender:({record:e})=>{const o=0==~~e.hideMenu,a=o?"显示":"隐藏";return t(l,{color:o?"green":"red"},(()=>a))}},{title:"创建时间",dataIndex:"createTime"}],F=[{field:"name",label:"菜单名称",component:"Input",componentProps:{placeholder:"请输入菜单名称"},colProps:{span:8}},{field:"hideMenu",label:"是否隐藏",component:"Select",componentProps:{options:[{label:"显示",value:"0"},{label:"隐藏",value:"1"}]},colProps:{span:7}},{field:"dateRange",label:"创建时间",component:"RangePicker",componentProps:{style:{width:"100%"},valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]},colProps:{span:8}}],S=[{field:"id",label:"ID",component:"Input",show:!1},{field:"parentId",label:"上级菜单",component:"TreeSelect",defaultValue:"0",required:!0,componentProps:{allowClear:!1,replaceFields:{title:"name",key:"id",value:"id"},getPopupContainer:()=>document.body}},{field:"type",label:"菜单类型",component:"RadioButtonGroup",defaultValue:"M",componentProps:{options:[{label:"目录",value:"M"},{label:"菜单",value:"C"},{label:"按钮",value:"F"}]},dynamicRules:({model:o})=>[{validator:(a,t)=>e(this,null,(function*(){if(0!=~~(null==o?void 0:o.parentId)){const e=yield b(o.parentId);switch(null==e?void 0:e.type){case"M":if("F"==t)return Promise.reject("检测到上级菜单为目录类型子项不允许选择按钮类型!");break;case"C":if("F"!=t)return Promise.reject("检测到上级菜单为菜单类型子项只允许选择按钮类型!")}}else if("F"==t)return Promise.reject("根级菜单子项不允许选择按钮类型!");return Promise.resolve()})),validateTrigger:"change"}]},{field:"icon",label:"菜单图标",component:"IconPicker",ifShow:({values:e})=>!x(e.type)},{field:"name",label:"菜单名称",component:"Input",required:!0,colProps:{span:12}},{field:"path",label:"路由地址",component:"Input",colProps:{span:12},ifShow:({values:e})=>!x(e.type)},{field:"component",label:"组件路径",component:"Input",colProps:{span:12},ifShow:({values:e})=>R(e.type)},{field:"permission",label:"权限标识",component:"Input",required:!0,colProps:{span:12},ifShow:({values:e})=>x(e.type)},{field:"sort",label:"菜单排序",component:"InputNumber",componentProps:{style:{width:"100%"},min:0},required:!0,colProps:{span:12}},{field:"keepalive",label:"是否缓存",component:"RadioButtonGroup",defaultValue:"0",componentProps:{options:[{label:"否",value:"0"},{label:"是",value:"1"}]},colProps:{span:12},ifShow:({values:e})=>R(e.type)},{field:"hideMenu",label:"是否隐藏",component:"RadioButtonGroup",defaultValue:"0",componentProps:{options:[{label:"否",value:"0"},{label:"是",value:"1"}]},colProps:{span:12},ifShow:({values:e})=>!x(e.type)},{field:"hideChildrenMenu",label:"是否隐藏子菜单",component:"RadioButtonGroup",defaultValue:"0",componentProps:{options:[{label:"否",value:"0"},{label:"是",value:"1"}]},colProps:{span:12},ifShow:({values:e})=>"M"===e.type}];var j=n({emits:["success","register"],setup(t,{emit:l}){const n=i({tag:"",menuTree:[]}),[f,{resetFields:R,setFieldsValue:x,updateSchema:M,validate:F,clearValidate:j}]=o({labelWidth:100,schemas:S,showActionButtonGroup:!1,baseColProps:{span:24}}),[k,{setModalProps:B,closeModal:C}]=I(((...o)=>e(this,[...o],(function*(e={_tag:""}){var o;yield R(),yield j(),n.tag=e._tag;const a={id:"0",name:"顶级菜单",children:[]};n.menuTree=h(yield P()),a.children=n.menuTree,yield M([{field:"parentId",componentProps:{treeData:[a]}},{field:"type",componentProps:{disabled:"edit"==n.tag}}]);const t=null==(o=e.record)?void 0:o.id,l={confirmLoading:!1};switch(n.tag){case"add":l.title="新增菜单",t&&(yield x({parentId:t}));break;case"edit":l.title="编辑菜单",yield x(yield b(t))}B(l)}))));function T(){return e(this,null,(function*(){try{const e=yield F();switch(B({confirmLoading:!0}),n.tag){case"add":const o=v(m(n.menuTree),(o=>o.id==(null==e?void 0:e.parentId)));e.parentIds=(o||[]).map((e=>e.id)),yield g(e);break;case"edit":yield y(e)}C(),l("success")}finally{B({confirmLoading:!1})}}))}return(e,o)=>(r(),s(c(w),u(e.$attrs,{width:"720px",onOk:T,onRegister:c(k)}),{default:d((()=>[p(c(a),{onRegister:c(f)},null,8,["onRegister"])])),_:1},16,["onRegister"]))}});export{j as _,M as c,F as s};
