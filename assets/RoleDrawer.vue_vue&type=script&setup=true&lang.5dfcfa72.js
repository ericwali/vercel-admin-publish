var e=(e,t,a)=>new Promise(((n,s)=>{var l=e=>{try{d(a.next(e))}catch(t){s(t)}},o=e=>{try{d(a.throw(e))}catch(t){s(t)}},d=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,o);d((a=a.apply(e,t)).next())}));import{d as t,c as a}from"./useForm.f93bccee.js";import{af as n,cb as s,c1 as l,B as o,N as d,D as i,_ as r,a2 as c,w as u,u as m,a1 as p,t as h}from"./vendor.7c679a32.js";/* empty css              *//* empty css              */import{c as f,g as y,e as b,a as g}from"./role.33dd7932.js";import{l as k}from"./tenant.97003ced.js";import{a7 as v,aG as I}from"./index.6a5548ea.js";import{u as x,B as w}from"./index.32a4a07a.js";import{_ as j}from"./Tree.vue_vue&type=style&index=0&lang.a6d5c734.js";import{l as C,b as K}from"./menu.9d58d752.js";const{createConfirm:P}=v(),T=[{title:"角色名称",dataIndex:"name",width:200},{title:"角色排序",dataIndex:"sort",width:200},{title:"状态",dataIndex:"status",width:120,customRender:({record:t})=>(Reflect.has(t,"pendingStatus")||(t.pendingStatus=!1),n(s,{checked:"0"===t.status,checkedChildren:"已启用",unCheckedChildren:"已禁用",loading:t.pendingStatus,onChange(a){const n=a?"启用":"停用";P({iconType:"warning",title:"警告",content:`确认要"${n}${t.name}角色吗?`,onOk:()=>e(this,null,(function*(){t.pendingStatus=!0;const e=a?"0":"1",{createMessage:s}=v();f(t.id,e).then((()=>{t.status=e,s.success(`${n}成功`)})).catch((()=>{s.error(`${n}失败`)})).finally((()=>t.pendingStatus=!1))}))})}}))},{title:"备注",dataIndex:"remarks",customRender:({record:e})=>e.remarks||n(l,{color:"red"},(()=>"暂无数据"))},{title:"创建时间",dataIndex:"createTime"}],F=[{field:"name",label:"角色名称",component:"Input",componentProps:{placeholder:"请输入角色名称"},colProps:{span:8}},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"启动",value:"0"},{label:"停用",value:"1"}]},colProps:{span:7}}],R=[{field:"id",label:"ID",component:"Input",show:!1},{field:"name",label:"角色名称",required:!0,component:"Input"},{field:"sort",label:"角色排序",component:"InputNumber",componentProps:{style:{width:"100%"},min:0},required:!0},{field:"tenantIds",label:"多租户",component:"ApiSelect",required:!0,componentProps:{mode:"multiple",api:k,labelField:"name",valueField:"id",resultField:"data"}},{field:"status",label:"状态",component:"RadioButtonGroup",defaultValue:"0",componentProps:{options:[{label:"启用",value:"0"},{label:"停用",value:"1"}]}},{label:"备注",field:"remarks",component:"InputTextArea"},{label:"",field:"menuIds",slot:"menu",component:"Input"}];var _=o({emits:["success","register"],setup(n,{emit:s}){const l=d({tag:"",menuTree:[],checkedKeys:{}}),[o,{resetFields:f,setFieldsValue:k,validate:v,clearValidate:P}]=t({labelWidth:100,schemas:R,showActionButtonGroup:!1,baseColProps:{span:24}}),[T,{setDrawerProps:F,closeDrawer:_}]=x(((...t)=>e(this,[...t],(function*(e={_tag:""}){var t,a,n,s;yield f(),yield P(),l.tag=e._tag,l.menuTree=I(yield C());const o=null==(t=e.record)?void 0:t.id,d={confirmLoading:!1};switch(l.tag){case"add":d.title="新增角色";break;case"edit":d.title="编辑角色";const e=yield K(o),t=yield y(o),i={checkedKeys:null==(n=null==(a=e.extend)?void 0:a.filter((e=>"1"==e.checkeType)))?void 0:n.map((e=>e.menuId)),halfCheckedKeys:null==(s=e.extend.filter((e=>"2"==e.checkeType)))?void 0:s.map((e=>e.menuId))};l.checkedKeys=i,yield k(Object.assign({},t,{menuIds:i.checkedKeys}))}F(d)}))));function S(e,t){l.checkedKeys={checkedKeys:e,halfCheckedKeys:t.halfCheckedKeys}}function D(){return e(this,null,(function*(){try{const e=yield v();switch(F({confirmLoading:!0}),e.menuIds=h(l.checkedKeys),l.tag){case"add":yield g(e);break;case"edit":yield b(e)}_(),s("success")}finally{F({confirmLoading:!1})}}))}return(e,t)=>(i(),r(m(w),p(e.$attrs,{width:"500px",showFooter:"",onOk:D,onRegister:m(T),onVisibleChange:t[0]||(t[0]=e=>m(l).checkedKeys={})}),{default:c((()=>[u(m(a),{onRegister:m(o)},{menu:c((({model:e,field:t})=>[u(m(j),{value:e[t],"onUpdate:value":a=>e[t]=a,title:"菜单分配",toolbar:"",checkable:"",treeData:m(l).menuTree,replaceFields:{title:"name",key:"id"},onCheck:S},null,8,["value","onUpdate:value","treeData"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister"]))}});export{_,T as c,F as s};
