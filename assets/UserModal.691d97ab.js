var e=(e,a,t)=>new Promise(((s,o)=>{var n=e=>{try{r(t.next(e))}catch(a){o(a)}},l=e=>{try{r(t.throw(e))}catch(a){o(a)}},r=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,l);r((t=t.apply(e,a)).next())}));import{B as a,a as t}from"./index.1d3e54eb.js";import{c as s,d as o}from"./useForm.f93bccee.js";import{af as n,cb as l,B as r,N as d,t as i,Z as p,D as c,_ as m,a2 as u,w as g,a1 as f}from"./vendor.7c679a32.js";/* empty css              */import{l as h}from"./role.33dd7932.js";import{aM as b,a7 as P,aG as w,aN as y,aO as I,aP as v,aQ as x}from"./index.6a5548ea.js";import{l as S}from"./dept.5ad51f22.js";const{createConfirm:k}=P(),F=[{title:"用户名称",dataIndex:"userName",width:120},{title:"用户昵称",dataIndex:"nickName",width:120},{title:"机构名称",dataIndex:"deptName",width:200},{title:"手机号码",dataIndex:"phone",width:200},{title:"状态",dataIndex:"status",width:120,customRender:({record:a})=>(Reflect.has(a,"pendingStatus")||(a.pendingStatus=!1),n(l,{checked:"0"===a.status,checkedChildren:"已启用",unCheckedChildren:"已禁用",loading:a.pendingStatus,onChange(t){const s=t?"启用":"停用";k({iconType:"warning",title:"警告",content:`确认要"${s}${a.userName}用户吗?`,onOk:()=>e(this,null,(function*(){a.pendingStatus=!0;const e=t?"0":"1",{createMessage:o}=P();b(a.id,e).then((()=>{a.status=e,o.success(`${s}成功`)})).catch((()=>{o.error(`${s}失败`)})).finally((()=>a.pendingStatus=!1))}))})}}))},{title:"创建时间",dataIndex:"createTime",width:180}],M=[{field:"userName",label:"用户名称",component:"Input",componentProps:{placeholder:"请输入用户名称"},colProps:{span:8}},{field:"dateRange",label:"创建时间",component:"RangePicker",componentProps:{style:{width:"100%"},valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]},colProps:{span:8}}],N=[{field:"id",label:"ID",component:"Input",show:!1},{field:"nickName",label:"用户昵称",component:"Input",required:!0,colProps:{span:12}},{field:"deptId",label:"归属机构",component:"TreeSelect",componentProps:{replaceFields:{title:"name",key:"deptId",value:"deptId"},getPopupContainer:()=>document.body},required:!0,colProps:{span:12}},{field:"phone",label:"手机号",component:"Input",rules:[{required:!0,message:"请输入手机号！"},{pattern:new RegExp("^1[3|4|5|6|7|8|9][0-9]\\d{8}$"),message:"请输入正确的手机号码!",validateTrigger:"blur"}]},{field:"email",label:"邮箱",component:"Input",rules:[{required:!0,message:"请输入邮箱！"},{type:"email",message:"请输入正确的邮箱地址!",validateTrigger:["blur","change"]}]},{field:"userName",label:"用户名",component:"Input",required:!0,colProps:{span:12}},{field:"password",label:"密码",component:"InputPassword",colProps:{span:12},rules:[{required:!0,whitespace:!0,message:"请输入密码！"},{pattern:new RegExp("[^\\u4e00-\\u9fa5]+"),type:"string",message:"密码不能输入汉字！"},{min:6,max:32,message:"长度必需在6-32之间！"}]},{field:"sex",label:"性别",component:"Select",required:!0,componentProps:{options:[{label:"男",value:"0"},{label:"女",value:"1"}]},colProps:{span:12}},{field:"status",label:"状态",component:"RadioGroup",defaultValue:"0",componentProps:{options:[{label:"正常",value:"0"},{label:"停用",value:"1"}]},colProps:{span:12}},{field:"roleIds",label:"授权角色",component:"ApiSelect",required:!0,componentProps:{mode:"multiple",api:h,labelField:"name",valueField:"id",resultField:"data"},colProps:{span:12}},{label:"备注",field:"remarks",component:"InputTextArea",componentProps:{rows:6},colProps:{span:24}}];var R=r({name:"UserModal",components:{BasicModal:a,BasicForm:s},emits:["success","register"],setup(a,{emit:s}){const n=d({tag:"",deptTree:[]}),{createMessage:l}=P(),[r,{resetFields:p,setFieldsValue:c,updateSchema:m,validate:u,clearValidate:g}]=o({labelWidth:100,schemas:N,showActionButtonGroup:!1,actionColOptions:{span:24}}),[f,{setModalProps:h,closeModal:b}]=t(((...a)=>e(this,[...a],(function*(e={_tag:""}){var a;yield p(),yield g(),n.tag=e._tag,n.deptTree=w(yield S());const t=null==(a=e.record)?void 0:a.id,s={confirmLoading:!1};switch(yield m([{field:"deptId",componentProps:{treeData:i(n.deptTree)}},{field:"password",ifShow:"add"==n.tag}]),n.tag){case"add":s.title="新增用户";break;case"edit":s.title="编辑用户";const e=yield y(t);yield c(e.result)}h(s)}))));return{registerModal:f,registerForm:r,handleSubmit:function(){return e(this,null,(function*(){try{const e=yield u();if(h({confirmLoading:!0}),e.deptName=I(e.deptId,i(n.deptTree),{idField:"deptId"}),!e.deptName)return l.error("部门名称数据为空,请重试!");switch(n.tag){case"add":yield x(e);break;case"edit":yield v(e)}b(),s("success")}finally{h({confirmLoading:!1})}}))}}}});R.render=function(e,a,t,s,o,n){const l=p("BasicForm"),r=p("BasicModal");return c(),m(r,f(e.$attrs,{width:"720px",onOk:e.handleSubmit,onRegister:e.registerModal}),{default:u((()=>[g(l,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},16,["onOk","onRegister"])};var T=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:R});export{T as U,R as _,F as c,M as s};
