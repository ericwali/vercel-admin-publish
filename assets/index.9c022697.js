var e=(e,t,i)=>new Promise(((o,a)=>{var l=e=>{try{n(i.next(e))}catch(t){a(t)}},s=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(l,s);n((i=i.apply(e,t)).next())}));import{u as t,_ as i}from"./useTable.81787a2e.js";import{B as o,_ as a}from"./useForm.f93bccee.js";import{U as l,af as s,a7 as n}from"./index.6a5548ea.js";import{d as r,g as d}from"./download.38a3a81a.js";import{B as c,N as m,Z as u,bE as p,D as f,E as x,w as b,a2 as y,F as h,u as j,a9 as g,t as v}from"./vendor.7c679a32.js";import"./props.df8b9a2a.js";import"./const.ba9bd2e6.js";import"./useWindowSizeFn.bec912bd.js";import"./index.1d3e54eb.js";import"./onMountedOrActivated.51a605f4.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./dateUtil.839e4f2c.js";/* empty css              */import"./useSortable.7806d92e.js";/* empty css              *//* empty css              *//* empty css              */import"./index.1c4a88d9.js";/* empty css              */import"./index.3b2c921a.js";const{apiUrl:w}=l();var S,_;(_=S||(S={})).list="/system_proxy/system/file/list",_.get="/system_proxy/system/file/getFile",_.getLocal="/system_proxy/system/file/local",_.del="/system_proxy/system/file/remove";const I=e=>s.get({url:S.list,params:e},{isReturnResultResponse:!0}),N=[{title:"源文件名称",dataIndex:"original"},{title:"空间名称",dataIndex:"bucketName"},{title:"文件名称",dataIndex:"fileName"},{title:"文件类型",dataIndex:"type"},{title:"文件大小",dataIndex:"fileSize",customRender:({record:e})=>d(e.fileSize)},{title:"上传人",dataIndex:"createByName"},{title:"创建时间",dataIndex:"createTime"}],R=[{field:"fileName",label:"文件名称",component:"Input",componentProps:{placeholder:"请输入文件名称"},colProps:{span:6}}],{uploadUrl:k=""}=l(),C=(e,t)=>s.uploadFile({url:k,onUploadProgress:t},e),P=g("删除");var $=c({setup(l){const d=m({single:!0,multiple:!0,fileList:[]}),{createConfirm:c,createMessage:g}=n(),[_,{reload:k,clearSelectedRowKeys:$,getSelectRowKeys:F}]=t({title:"文件列表",api:I,rowKey:"id",columns:N,formConfig:{labelWidth:120,schemas:R,autoSubmitOnEnter:!0},rowSelection:{type:"checkbox"},useSearchForm:!0,showTableSetting:!0,bordered:!0,clickToRowSelect:!1,showIndexColumn:!1,actionColumn:{width:220,title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:!1},handleSearchInfoFn:()=>$()});function U(e){const t=v(null==e?void 0:e.keys)||[];d.single=1!=t.length,d.multiple=!t.length}function L(e){d.fileList=[],e(),B()}function T(e){var t,i;(t=null==e?void 0:e.bucketName,i=null==e?void 0:e.fileName,Promise.resolve(r({url:`${w}${S.get}/${t}/${i}`,fileName:i}))).then((()=>g.success(`${null==e?void 0:e.fileName}文件下载成功!`)))}function z(t){return e(this,null,(function*(){const i=(null==t?void 0:t.id)||F();c({iconType:"warning",title:"警告",content:`是否确认删除文件编号为${i}文件吗?`,onOk:()=>e(this,null,(function*(){yield(e=>s.delete({url:`${S.del}/${e}`}))(i),g.success("删除成功!"),B()}))})}))}function B(){$(),k()}return(e,t)=>{const l=u("a-button"),s=p("auth");return f(),x("div",null,[b(j(i),{onRegister:j(_),onSelectionChange:U},{toolbar:y((()=>[h(b(j(o),{value:j(d).fileList,"onUpdate:value":t[0]||(t[0]=e=>j(d).fileList=e),maxSize:20,maxNumber:10,showPreviewNumber:!1,emptyHidePreview:!0,api:j(C),accept:["image/*"],multiple:"",onSuccess:L},null,8,["value","api"]),[[s,["file_upload"]]]),h(b(l,{type:"primary",disabled:j(d).multiple,onClick:t[1]||(t[1]=e=>z())},{default:y((()=>[P])),_:1},8,["disabled"]),[[s,["file_del"]]])])),action:y((({record:e})=>[b(j(a),{actions:[{label:"文件下载",icon:"fa6-regular:circle-down",auth:["file_download"],onClick:T.bind(null,e)},{label:"删除",icon:"ant-design:delete-outlined",color:"error",auth:["file_del"],onClick:z.bind(null,e)}]},null,8,["actions"])])),_:1},8,["onRegister"])])}}});export{$ as default};
